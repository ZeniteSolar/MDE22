Version 4
SHEET 1 2628 1900
WIRE 128 -208 128 -240
WIRE 192 -208 192 -240
WIRE 128 -80 128 -128
WIRE 192 -80 192 -128
WIRE -224 -64 -224 -80
WIRE 512 0 384 0
WIRE 736 0 576 0
WIRE -112 48 -144 48
WIRE -368 64 -624 64
WIRE -224 64 -224 16
WIRE -224 64 -288 64
WIRE -176 64 -224 64
WIRE 688 64 656 64
WIRE -64 80 -112 80
WIRE 128 80 -64 80
WIRE 240 80 208 80
WIRE 272 80 240 80
WIRE 384 80 384 0
WIRE 384 80 352 80
WIRE 416 80 384 80
WIRE 528 80 496 80
WIRE 624 80 528 80
WIRE -176 96 -224 96
WIRE 240 96 240 80
WIRE 528 96 528 80
WIRE 736 96 736 0
WIRE 736 96 688 96
WIRE 976 96 736 96
WIRE 1104 96 976 96
WIRE -112 112 -144 112
WIRE 624 112 576 112
WIRE 688 128 656 128
WIRE -368 160 -432 160
WIRE -224 160 -224 96
WIRE -224 160 -288 160
WIRE -192 160 -224 160
WIRE -64 160 -64 80
WIRE -64 160 -112 160
WIRE 576 160 576 112
WIRE 736 160 736 96
WIRE 736 160 576 160
WIRE 240 176 240 160
WIRE 528 176 528 160
WIRE -432 208 -432 160
WIRE 976 224 976 176
WIRE 0 384 -32 384
WIRE -256 400 -352 400
WIRE -64 400 -176 400
WIRE -352 416 -352 400
WIRE 48 416 0 416
WIRE -64 432 -112 432
WIRE 0 448 -32 448
WIRE -112 496 -112 432
WIRE -80 496 -112 496
WIRE 48 496 48 416
WIRE 48 496 0 496
WIRE -112 512 -112 496
WIRE -352 528 -352 496
FLAG 128 -80 0
FLAG 128 -240 vcc
FLAG 192 -80 0
FLAG 192 -240 vee
FLAG 1104 96 Vsen
IOPIN 1104 96 Out
FLAG 976 224 0
FLAG 528 176 0
FLAG 240 176 0
FLAG -112 112 vcc
FLAG -112 48 vee
FLAG -224 -80 0
FLAG 688 128 vcc
FLAG 688 64 vee
FLAG -704 64 0
FLAG -432 208 Vref
FLAG 0 448 vcc
FLAG 0 384 vee
FLAG -112 592 0
FLAG -352 528 0
FLAG 48 416 Vref
SYMBOL voltage 128 -224 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V1
SYMATTR Value 18
SYMBOL voltage 192 -224 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V2
SYMATTR Value 0
SYMBOL res 960 80 R0
SYMATTR InstName R1
SYMATTR Value 10k
SYMBOL cap 576 -16 R90
WINDOW 0 0 32 VBottom 2
WINDOW 3 32 32 VTop 2
SYMATTR InstName C1
SYMATTR Value 100n
SYMBOL cap 544 96 M0
SYMATTR InstName C2
SYMATTR Value 100n
SYMBOL res 512 64 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R2
SYMATTR Value 1k
SYMBOL res 368 64 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R3
SYMATTR Value 1k
SYMBOL cap 256 96 M0
SYMATTR InstName C3
SYMATTR Value 100n
SYMBOL res 224 64 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R4
SYMATTR Value 1k
SYMBOL res -240 -80 R0
SYMATTR InstName R5
SYMATTR Value 1k2
SYMBOL res -96 144 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R6
SYMATTR Value 1k2
SYMBOL res -384 80 R270
WINDOW 0 32 56 VTop 2
WINDOW 3 0 56 VBottom 2
SYMATTR InstName R7
SYMATTR Value 1k
SYMBOL res -384 176 R270
WINDOW 0 32 56 VTop 2
WINDOW 3 0 56 VBottom 2
SYMATTR InstName R8
SYMATTR Value 1k
SYMBOL Opamps\\opamp2 -144 144 M180
WINDOW 0 -48 62 Left 2
WINDOW 3 -42 118 Left 2
SYMATTR InstName AmpOp1
SYMATTR Value LM324
SYMBOL Opamps\\opamp2 656 160 M180
WINDOW 0 -42 60 Left 2
WINDOW 3 -40 112 Left 2
SYMATTR InstName AmpOp2
SYMATTR Value LM324
SYMBOL voltage -608 64 R90
WINDOW 3 -180 -5 Left 2
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR Value SINE(12.5 2 100)
SYMATTR InstName V3
SYMBOL res 16 480 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R9
SYMATTR Value 1k1
SYMBOL res -272 416 R270
WINDOW 0 32 56 VTop 2
WINDOW 3 0 56 VBottom 2
SYMATTR InstName R10
SYMATTR Value 1k
SYMBOL res -96 608 R180
WINDOW 0 36 76 Left 2
WINDOW 3 36 40 Left 2
SYMATTR InstName R11
SYMATTR Value 1k
SYMBOL Opamps\\opamp2 -32 480 M180
WINDOW 0 -48 62 Left 2
WINDOW 3 -42 118 Left 2
SYMATTR InstName AmpOp3
SYMATTR Value LM324
SYMBOL voltage -352 400 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V4
SYMATTR Value 5
TEXT 1432 -496 Left 2 !* BEGIN SPICE MODEL LM324\n* ON SEMICONDUCTOR NEXT GEN MODEL 9/27/2018\n* MODEL FEATURES INCLUDE OUTPUT SWING, OUTPUT CURRENT\n* THROUGH THE SUPPLY RAILS, CLASS B OUTPUT STAGE, OUTPUT\n* SWING, OPEN LOOP GAIN AND PHASE WITH RL AND CL EFFECTS,\n* POWER SUPPLY REJECTION WITH FREQUENCY EFFECTS, COMMON\n* MODE REJECTION WITH FREQUENCY EFFECTS, INPUT VOLTAGE\n; NOISE WITH 1/F, INPUT CURRENT NOISE, INPUT BIAS AND\n* OFFSET CURRENT, INPUT COMMON MODE VOLTAGE RANGE, VOS\n* WITH TEMPERATURE EFFECTS, AND QUIESCENT CURRENT WITH\n* TEMPERATURE EFFECTS.\n* MODEL TOTAL SUPPLY VOLTAGE RANGE IS 3 TO 36 V.\n* MODEL TEMP RANGE IS -55 TO +125 DEG C.\n* NOTE THAT MODEL IS FUNCTIONAL OVER THIS TEMP RANGE\n* BUT NOT ALL PARAMETERS TRACK THOSE OF THE REAL PART.\n* NOTE THAT LIKE THE REAL PART THERE IS NO AB BIAS\n* IN THE OUTPUT STAGE WHICH UNDER SOME CIRCUMSTANCES\n* CAUSES HIGH OUTPUT IMPEDANCE AND OR CROSSOVER DELAY\n* WHICH CAN EFFECT THE PERFORMANCE IN SOME CIRCUITS.\n* THE COMBINATION OF OUTPUT CURRENT SINK AND NO AB\n* BIAS WHEN USED WITH A LARGE CLOAD CAN CAUSE SOME\n* INTERESTING SMALL SIGNAL STEP OVERSHOOTS THAT ARE\n* LARGER THAN NORMAL AND RAMP LINEARLY RATHER THAN\n* BEING SHAPED LIKE A CLASSIC OVERSHOOT. THIS HAPPENS\n* IDENTICALLY WITH THE REAL PART AND THE MODEL.\n*\n* PINOUT ORDER +IN -IN +V -V OUT\n* PINOUT ORDER  1   2   3  4  5\n.SUBCKT LM324 1 2 3 4 5\nR44 4 6 4E4\nI1 4 7 0.5E-6\nQ1 4 8 9 QPI\nQ2 4 2 10 QPA\nQ3 9 9 11 QPI\nQ4 10 10 11 QPI\nQ5 12 13 4 QNQ\nQ6 13 13 4 QNQ\nQ7 4 12 14 QPQ\nQ8 3 14 6 QNQ\nQ9 15 6 4 QNQ\nQ10 3 15 16 QNQ\nQ11 3 16 17 QNQ\nR67 17 16 4E4\nR68 5 17 18\nQ12 4 15 5 QPQ\nQ13 15 17 5 QNQ\nI2 18 3 120E-9\nI3 19 3 60E-9\nI4 20 3 1E-6\nQ14 11 18 3 QPQ\nQ15 14 19 3 QPQ\nQ16 5 7 4 QNQ\nQ17 15 20 3 QPQ\nC15 21 22 4.8E-12\nR69 12 21 3\nR70 12 15 3E9\nE2 23 8 3 0 -10E-6\nV51 23 1 1.56E-3\nI6 3 4 5E-6\nR71 4 3 4.5E5\nQ18 12 9 11 QPQ\nQ19 13 10 11 QPQ\nC17 12 13 8E-12\nC18 6 15 1E-12\nC21 3 24 100E-15\nR78 11 24 3E5\nC22 1 2 0.23E-12\nC23 2 0 0.79E-12\nC24 1 0 0.79E-12\nE3 22 0 15 0 2\nC25 5 0 50E-15\nQ20 25 25 0 QNQ\nG1 3 4 VT 0 3E-4\nI7 0 25 1E-3\nV53 25 26 0.25\nR79 0 26 1E6\nE4 VT 0 27 26 1\nR80 0 VT 1E6\nV54 27 0 0.55\nR81 0 27 1E6\n.MODEL QPQ PNP IKF=3E-3 RC=300 KF=4.8E-17 BR=1\n.MODEL QPA PNP IKF=3E-3 RC=380 IS=1.01E-16 VAF=245 RE=5 RB=1700 BF=300 KF=4.8E-17 BR=1\n.MODEL QPI PNP IKF=3E-3 RC=380 IS=1.01E-16 VAF=290 RE=5 RB=1700 BF=306 KF=4.8E-17 BR=1\n.MODEL QNQ NPN IKF=5E-3 RC=25  KF=4.8E-17 BR=1\n.ENDS\n* END SPICE MODEL LM324
TEXT -1072 240 Left 2 !.tran 0 0.025 0 0.00001
